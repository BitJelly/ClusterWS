module.exports=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=7)}([function(e,t,n){"use strict";function r(e){console.log("[36m%s[0m",e)}function o(e){console.log("[31m%s[0m",e)}function s(e){process.env.DEBUG&&console.log("DEBUG: ",e)}Object.defineProperty(t,"__esModule",{value:!0}),t.logRunning=r,t.logError=o,t.logDebug=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return function t(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.length<e.length?function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.call.apply(t,[null].concat(n,e))}:e.length?e.call.apply(e,[null].concat(n)):e}},o=function(e){return e?"function"==typeof e?e():e:""},s=r(function(e,t){return o(t in e?e[t]:e.default)}),i=function(e,t){for(var n=-1,r=null==t?0:t.length,o=new Array(r);++n<r;)o[n]=e(t[n],n,t);return o},c=function(e,t){var n={};return t=Object(t),Object.keys(t).forEach(function(r){return n[r]=e(t[r],r,t)}),n},u=r(function(e,t){return t instanceof Array?i(e,t):c(e,t)});t._={map:u,curry:r,switchcase:s}},function(e,t,n){"use strict";function r(e,t){return{type:e,data:t}}function o(e,t,n){i._.switchcase({pub:JSON.stringify({m:["p",e,t]}),emt:JSON.stringify({m:["e",e,t]}),sys:JSON.stringify({m:["s",e,t]}),ping:e})(n)}function s(e,t){return JSON.stringify({channel:e,data:t})}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);t.processMessages=r,t.socketMessages=o,t.brokerMessage=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(0),s=function(){function e(){this._events={}}return e.prototype.on=function(e,t){t&&"function"==typeof t||o.logError("Listener must be a function"),this._events[e]?this._events[e].push(t):this._events[e]=[t]},e.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];r._.map(function(e){return e.call.apply(e,[null].concat(t))},this._events[e])},e.prototype.removeListener=function(e,t){var n=this;r._.map(function(r,o){return r===t?n._events[e].splice(o,1):""},this._events[e])},e.prototype.removeEvent=function(e){this._events[e]=null},e.prototype.removeAllEvents=function(){this._events={}},e.prototype.exist=function(e){return this._events[e]},e}();t.EventEmitter=s},function(e,t){e.exports=require("cluster")},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=n(6),i=function(e){function t(t,n){var r=e.call(this)||this;return r.port=t,r.buffer="",t instanceof s.Socket?r.socket=t:r.socket=s.connect(t,n),r.socket.on("end",function(){return r.emit("disconnect")}),r.socket.on("error",function(e){return r.emit("error",e)}),r.socket.on("connect",function(){return r.emit("connect")}),r.socket.on("data",function(e){var t=e.toString(),n=t.indexOf("\n");if(-1===n)return r.buffer+=t;r.emit("message",r.buffer+t.slice(0,n));for(var o=n+1;-1!==(n=t.indexOf("\n",o));)r.emit("message",t.slice(o,n)),o=n+1;r.buffer=t.slice(o)}),r}return r(t,e),t.prototype.send=function(e){this.socket.write(e+"\n")},t}(o.EventEmitter);t.TcpSocket=i},function(e,t){e.exports=require("net")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),o=n(8),s=n(9),i=n(11),c=function(){function e(t){if(this.configurations=t,!e.instance){e.instance=this;var n=new o.Options(this.configurations||{});r.isMaster?s.processMaster(n):i.processWorker(n)}}return e}();t.ClusterWS=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=function(){function e(e){if(!e.worker)throw r.logError("Worker function must be provided");this.port=e.port||80,this.worker=e.worker,this.workers=e.workers||1,this.brokerPort=e.brokerPort||9346,this.pingInterval=e.pingInterval||2e4,this.restartWorkerOnFail=e.restartWorkerOnFail||!1}return e}();t.Options=o},function(e,t,n){"use strict";function r(e){var t=[];c.logRunning(">>> Master on: "+e.port+", PID "+process.pid);var n=function(n,r){t[n]=0===n?">>> Broker on: "+e.brokerPort+", PID "+r:"          Worker: "+n+", PID "+r,i.count(t)===e.workers+1&&s._.map(function(e){return c.logRunning(e)},t)},r=function(t,i){var c=o.fork();c.on("message",function(e){return s._.switchcase({ready:function(){return n(i,e.data)}})(e.type)}),c.on("exit",function(){return e.restartWorkerOnFail?r(t,i):""}),c.send(u.processMessages(t,i))};r("broker",0);for(var f=1;f<=e.workers;f++)r("worker",f)}Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(1),i=n(10),c=n(0),u=n(2);t.processMaster=r},function(e,t,n){"use strict";function r(e){for(var t=0,n=0,r=e.length;n<r;n++)e[n]&&t++;return t}Object.defineProperty(t,"__esModule",{value:!0}),t.count=r},function(e,t,n){"use strict";function r(e){process.on("message",function(t){return o._.switchcase({worker:function(){return new s.Worker(e)},broker:function(){return new i.Broker(e)}})(t.type)}),process.on("uncaughtException",function(e){return c.logError("PID: "+process.pid+"\n"+e.stack+"\n")})}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),s=n(12),i=n(16),c=n(0);t.processWorker=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),o=n(14),s=n(0),i=n(5),c=n(15),u=n(3),f=n(2),a=function(){function e(e){var t=this;this.options=e,this.socketServer={};var n=new i.TcpSocket(this.options.brokerPort,"127.0.0.1");n.on("error",function(e){return s.logError("Worker, PID "+process.pid+"\n"+e.stack+"\n")}),n.on("message",function(e){return"#0"===e?n.send("#1"):t.socketServer.emitter.emit("#publish",JSON.parse(e))}),n.on("disconnect",function(){return s.logError("Broker has been disconnected")}),this.publish=function(e,r){n.send(f.brokerMessage(e,r)),t.socketServer.emitter.emit("#publish",{channel:e,data:r})},this.socketServer.emitter=new u.EventEmitter,this.socketServer.on=this.socketServer.emitter.on,this.httpServer=c.createServer().listen(this.options.port),new r.Server({server:this.httpServer}).on("connection",function(e){return t.socketServer.emitter.emit("connection",new o.Socket(e,t.socketServer.emitter,t.options))}),this.options.worker.call(this),process.send(f.processMessages("ready",process.pid))}return e}();t.Worker=a},function(e,t){e.exports=require("uws")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(3),s=n(2),i=function(){function e(e,t,n){var s=this;this.socket=e,this.channels=[],this.events=new o.EventEmitter;var i=function(e){return-1!==s.channels.indexOf(e.channel)?s.send(e.channel,e.data,"pub"):""};t.on("#publish",i);var c=0,u=setInterval(function(){return c++>2?s.disconnect(3001,"No pongs from socket"):s.send("#0",null,"ping")},n.pingInterval);this.socket.on("message",function(e){"#1"===e?c=0:e=JSON.parse(e),r._.switchcase({p:function(){return t.emit(e.m[1],e.m[2])},e:function(){return s.events.emit(e.m[1],e.m[2])},s:function(){return r._.switchcase({subscribe:function(){return-1!==s.channels.indexOf(e.m[2])?s.channels.push(e.m[2]):""},unsubscribe:function(){return s.channels.removeEvent(e.m[2])}})(e.m[1])}})(e.m[0])}),this.socket.on("close",function(e,t){s.events.emit("disconnect",e,t),clearInterval(u),s.events.removeAllEvents();for(var n in s)s.hasOwnProperty(n)&&(s[n]=null)}),this.socket.on("error",function(e){return s.events.emit("error",e)})}return e.prototype.on=function(e,t){this.socket.on(e,t)},e.prototype.send=function(e,t,n){this.socket.send(s.socketMessages(e,t,n||"emt"))},e.prototype.disconnect=function(e,t){this.socket.close(e,t)},e}();t.Socket=i},function(e,t){e.exports=require("http")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(0),s=n(5),i=n(2),c=n(6),u=function(){function e(e){var t=this;this.options=e,this.servers=[],this.broker=c.createServer(function(e){var n=t.servers.length,r=new s.TcpSocket(e);setInterval(function(){return r.send("#0")},2e4);t.servers[n]=r,r.on("error",function(e){return o.logError("Broker, PID "+process.pid+"\n"+e.stack+"\n")}),r.on("message",function(e){return"#1"!==e?t.broadcast(n,e):""}),r.on("disconnect",function(){return o.logError("Server "+n+" has disconnected")})}).listen(e.brokerPort),process.send(i.processMessages("ready",process.pid))}return e.prototype.broadcast=function(e,t){r._.map(function(n,r){return r!==e?n.send(t):""},this.servers)},e}();t.Broker=u}]);